#!/bin/sh

set -e
set -x

rm -rf ~/.hoogle
mkdir ~/.hoogle
# This is painfully and unnecessarily slow, fix GHC to provide a list
# exposed modules command with simple output and names only.
# And fix hoogle to not bail on rts or integer-gmp!
# Tac because hoogle is silly and is reversing the order of the command line.
PACKAGES=$(/opt/ceh/bin/ghc-pkg list | grep '^ ' | fgrep -v '(' | sed 's/^ *//' | /opt/ceh/bin/parallel ghc-pkg list --simple-output --names-only | tr ' ' '\n' | sort | uniq | tac | egrep -v '^(rts|integer-gmp|ghc-prim|bin-package-db)$')
hoogle data $PACKAGES -l -d ~/.hoogle
cd ~/.hoogle
hoogle combine *.hoo
