#!/opt/ceh/lib/perl
# -*- mode: perl; -*-

use strict;
use warnings;
use lib "/opt/ceh/lib";
use CehInstall;

# This is a 64-bit FF install with all the 3 required plugins:
#  - google talk,
#  - java (well, not working currently :( ),
#  - flash,
# please make sure to remove all the conflicting plugins from your
# system (~/.mozilla/firefox/plugins, /usr/lib/mozilla, etc.).
#
# To make sure everything is OK, use all 3 plugins while running
# firefox from a terminal and watch stderr.
#
# Do not ever mix 32-bit plugins with this 64-bit firefox!
# TODO(errge): an ld_preload hack that purifies this plugin issue, by
# hiding /usr/lib/mozilla, ~/.mozilla/plugins and whatever else that
# is needed.

# To enable google talk plugin and jre plugin.
$ENV{NIXPKGS_CONFIG}="/opt/ceh/lib/Packages/firefox.nix";
# TODO(errge): I had to update nixpkgs for firefox, otherwise hangouts plugin was not compatible with FF47
ceh_nixpkgs_install('firefoxCeh', nixpkgs_version => '21747ef768341b3322c8333f9dafb48961ced63f', out => 'y02vw3r92bwkh9zr7n24xanqp4x1bm6i-firefox-ceh');

exec "$ceh_nix_install_root/MAIN/bin/firefox", @ARGV;
